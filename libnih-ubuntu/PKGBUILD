# Maintainer: Xiao-Long Chen <chenxiaolong@cxl.epac.to>
# Maintainer: Michael Healy <horsemanoffaith@gmail.com>

# vercheck-pkgbuild: auto
# vercheck-ubuntu: name=${pkgname%-*}, repo=zesty
# vercheck-launchpad: name=${pkgname%-*}

pkgname=libnih-ubuntu
_ubuntu_rel=6ubuntu1
pkgver=1.0.3
pkgrel=1
pkgdesc="Light-weight library of standard C library functions"
arch=(i686 x86_64)
url="https://launchpad.net/libnih"
license=(GPL)
groups=(unity)
depends=(dbus expat)
provides=("${pkgname%-*}=${pkgver}")
conflicts=("${pkgname%-*}")
source=("https://launchpad.net/ubuntu/+archive/primary/+files/${pkgname%-*}_${pkgver}.orig.tar.gz"
        "https://launchpad.net/ubuntu/+archive/primary/+files/${pkgname%-*}_${pkgver}-${_ubuntu_rel}.diff.gz")
sha512sums=('fce40d2445b28c27b8838631681ca3206a4f053b2dd4fc488fc9ef98bbd3d933e3d62b82cf346be2ef1677f6457f692cf5544cd915a6bb1e5c618f98ffa101b4'
            '9445030b1540ec539858be51c053c22d4bf876e950832809fdace8490e2f119dd8cbc7842817c6e188c29c848dd5d591693479e7913443b53b327e2adf6c0f88')

prepare() {
    cd "${pkgname%-*}-${pkgver}"
    patch -p1 -i "${srcdir}/${pkgname%-*}_${pkgver}-${_ubuntu_rel}.diff"
}

build() {
    cd "${pkgname%-*}-${pkgver}"

    # From debian/rules
    export CFLAGS="-Wall -fstack-protector -fPIE ${CFLAGS}"
    export LDFLAGS="-Wl,--as-needed -Wl,-z,relro -Wl,-z,now -pie ${LDFLAGS}"

    autoreconf -vfi
    ./configure --prefix=/usr
    make
}

package() {
    cd "${pkgname%-*}-${pkgver}"
    make DESTDIR="${pkgdir}/" install
}
